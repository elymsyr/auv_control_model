# AUV Control Model

This repository implements an imitation learning pipeline for Autonomous Underwater Vehicle (AUV) control, using a neural network to approximate optimal control actions generated by a nonlinear Model Predictive Control (NL-MPC) policy.

![FossenNet Architecture](docs/media/fossennn.png)

## Repository Structure

- **control_test/**  
  Contains legacy and experimental approaches for AUV control, including various tested algorithms and development processes.

- **data/**  
  Stores datasets generated by the `Model/` folder, including HDF5 files with state, reference trajectory, and optimal thruster commands.

- **Model/**  
  - **train.ipynb**: Jupyter notebook for training the neural network model (`FossenNet`) on generated data.  
  - **test/**: C++ application for running inference using trained models (TorchScript), designed for GPU acceleration and real-time deployment.

## FossenNet

The core neural network architecture, `FossenNet`, is designed to capture the nonlinear dynamics of marine vehicles using domain knowledge (Fossen equations):

- **Inputs:**  
  - Current state (9 features)  
  - Reference trajectory (492 features, representing 41 timesteps × 12 features each)
- **Architecture:**  
  - State branch: Fully connected layers with batch normalization and dropout  
  - Reference branch: LSTM layers followed by fully connected layers  
  - Combined branch: Concatenates processed state and reference features, then passes through additional layers to predict 8 thruster commands
- **Training:**  
  - Uses MSE loss, AdamW optimizer, learning rate scheduling, and early stopping  
  - Normalization is applied to both inputs and outputs using domain-specific scaling factors

## Data Generation

- **Dataset includes:**  
  - Current state  
  - Desired state (path)  
  - Optimal thruster commands (`u_opt`)  
  - Next state  
- **Format:**  
  - Data is stored in HDF5 files (`data.h5`, `test_data.h5`)

```sh
docker pull elymsyr/auv_control_data_generation
docker run --gpus all -it elymsyr/auv_control_data_generation
```
After completion:
```sh
docker cp <container_id>:app/build/data.h5 <file_path_host>/data.h5
```

## Usage

1. **Prepare Data:**  
   Generate and export the dataset using the NL-MPC controller in Model folder.

2. **Train the Model:**  
   Run `train.ipynb` to train the `FossenNet` neural network on the generated data.

3. **Evaluate:**  
   The notebook provides visualization and metrics for model performance, including scatter plots, sample comparisons, and residual distributions.

4. **Inference:**  
   Use the C++ application in `test/` to run inference with trained TorchScript models for real-time control.

## Requirements

- Python 3.11
- PyTorch
- scikit-learn
- h5py
- matplotlib
- numpy

## Security Notice

⚠️ **This module is under active development and is not production-ready.**  
There may be untested features, incomplete security measures, or vulnerabilities.  
**Do not use this system in safety-critical or
